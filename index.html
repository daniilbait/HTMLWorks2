<!DOCTYPE html>
<html lang="ru">
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Лабораторная работа 5</title>
    <script defer>
      function Calc(serviceSelected, serviseCost)
      {
        const spanOutput = document.getElementById(`output`);//Находим поле вывода

        const preQuantity = document.querySelector(`.counter`); //Находим счетчик услуг
        const quantity = parseInt(preQuantity.value);           //Считываем значение со счетчика

        const displaySelect = document.getElementById(`selectBlock`);
        const displayCheckbox = document.getElementById(`multiCheckbox`);

        if(serviceSelected==1)//первая услуга
        {
          displaySelect.classList.add('d-none');
          displayCheckbox.classList.add('d-none');

          const select = document.getElementById('selection');
          select.selectedIndex = 0;
          const checkboxes = document.querySelectorAll('input[name="checkboxGoods"]');
          checkboxes.forEach(checkbox => {
            checkbox.checked = false;
          });
          
          
          if(isNaN(quantity) || quantity < 1)
          {
            spanOutput.innerHTML = `Введите корректное количество (положительное целое число)!`;
            return;
          }

          const totalPrice = quantity*serviseCost;
          spanOutput.innerHTML=`Стоимость услуги равна: ${totalPrice}руб.`;
        }
        else if(serviceSelected==2)//вторая услуга
        {
          displaySelect.classList.remove('d-none');
          displayCheckbox.classList.add('d-none');
          
          const checkboxes = document.querySelectorAll('input[name="checkboxGoods"]');
          checkboxes.forEach(checkbox => {
            checkbox.checked = false;
          });

          if(isNaN(quantity) || quantity < 1)
          {
            spanOutput.innerHTML = `Введите корректное количество (положительное целое число)!`;
            return;
          }

          const product = document.getElementById(`selection`);   //Находим список опций
          const prePrice = product.options[product.selectedIndex];//Считываем выбранную опцию
          const productPrice = parseInt(prePrice.value);          //Считываем значение с выбранной опции
          
          if (isNaN(productPrice)) //Проверяем, что опция выбрана
          {
            spanOutput.innerHTML = `Выберите опцию!`;
            return;
          }

          const totalPrice = quantity*(serviseCost+productPrice);
          spanOutput.innerHTML=`Стоимость услуги равна: ${totalPrice}руб.`;
        }
        else if(serviceSelected==3)//третья услуга
        {
          displaySelect.classList.add('d-none');
          displayCheckbox.classList.remove('d-none');
          
          const select = document.getElementById('selection');
          select.selectedIndex = 0;

          if(isNaN(quantity) || quantity < 1)
          {
            spanOutput.innerHTML = `Введите корректное количество (положительное целое число)!`;
            return;
          }

          const selectedCheckboxes = document.querySelectorAll('input[name="checkboxGoods"]:checked');
          let totalPrice=0;
          selectedCheckboxes.forEach(checkBox => {
            const value = parseInt(checkBox.value);
            if (!isNaN(value)) {
                totalPrice += value;
            }
          });
          totalPrice=quantity*(totalPrice+serviseCost);
          spanOutput.innerHTML=`Стоимость заказа равна: ${totalPrice}руб.`;
        }
      }
      document.addEventListener('DOMContentLoaded', function() 
      {
        const form = document.getElementById('form');
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => 
        {
          input.addEventListener('input', RadioChange);
          input.addEventListener('change', RadioChange);
        });

        form.addEventListener('click', RadioChange);
        const counterInput = document.querySelector('.counter');
        counterInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
        }
    });
      });
      function RadioChange()
      {
        const radioChosed = document.querySelector(`input[name="service"]:checked`);
        if(radioChosed)
        {
          const radioValue=parseInt(radioChosed.value);
          const radioCost=parseInt(radioChosed.dataset.price);
          Calc(radioValue, radioCost);
          
        }
        else
        {
          const spanOutput = document.getElementById(`output`);
          spanOutput.innerHTML = `Услуга еще не выбрана!`;
          return;
        }
      }
    </script>
  </head>
  <body>
    <form id="form" class="mx-auto mt-2 d-flex flex-column align-self-center p-1"> <!-- Форма -->
      <h1 class="mb-2">Калькулятор стоимости заказа фотоуслуги</h1>
      <div class="d-flex flex-column justify-content-between mb-1"><!--Счетчик (ввод числа)-->
        <label id="fullname">Количество:</label>
        <input class="counter" type="number" min="1" required="required">
      </div><!--Счетчик (ввод числа)-->
      <div class="d-flex flex-column"><!--Радиокнопки (услуга)-->
        <label>Выберите услугу:</label>
        <div class="ms-3">
          <input type="radio" name="service" value="1" data-price="250">
          <label>Печать фотографий (250р)</label>
        </div>
        <div class="ms-3">
          <input type="radio" name="service" value="2" data-price="800">
          <label>Создание фотоальбома (800р)</label>
        </div>
        <div class="ms-3">
          <input type="radio" name="service" value="3" data-price="1200">
          <label>Ретушь и обработка фото (1200р)</label>
        </div>
      </div><!--Радиокнопки (услуга)-->
      <div id="selectBlock" class="d-none flex-column"><!--Список (опция)-->
        <label>Выберите опцию товара:</label>
        <select id="selection" class="mb-2" required="required">
          <option value="0">Размер фото: 10×15 (0р)</option>
          <option value="250">Размер фото: 15х20 (250р)</option>
          <option value="600">Размер фото: 20х30 (600р)</option>
          <option value="1000">Размер фото: 30х40 (1000р)</option>
        </select>
      </div><!--Список (опция)-->
      <div id="multiCheckbox" class="d-none flex-column"><!--Чекбоксы (свойства товар)-->
        <label>Выберите свойство (-а) товара:</label>
        <div class="ms-3 d-flex flex-column">
          <div>
            <input type="checkbox" name="checkboxGoods" value="400">
            <label>Срочная печать (400р)</label>
          </div>
          <div>
            <input type="checkbox" name="checkboxGoods" value="150">
            <label>Ламинирование (150р)</label>
          </div>
          <div>
            <input type="checkbox" name="checkboxGoods" value="200">
            <label>Цветокоррекция (200р)</label>
          </div>
        </div>
      </div><!--Чекбоксы (свойства товар)-->
      <span id="output" class="mt-3 p-1">Выберите услугу.</span>
    </form> <!-- Форма -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  </body>
</html>

